AUI.add("liferay-portlet-journal",function(l){var h=l.DataType;var f=l.Lang;var g=function(){var u="";var t=Liferay.Portlet.Journal.PROXY.instanceIdKey;for(var s=0;s<8;s++){var v=Math.floor(Math.random()*t.length);u+=t.substring(v,v+1)}return u};var k=function(){return(++l.Env._uidx)};var i='<div id="{name}" name="{name}"></div>';var q='<div><li class="structure-field"><span class="journal-article-close"></span><span class="folder"><div class="field-container"><input class="journal-article-localized" type="hidden" value="false" /><div class="journal-article-move-handler"></div><label for="" class="journal-article-field-label"><span>{fieldLabel}</span></label><div class="journal-article-component-container"></div><span class="aui-field aui-field-choice journal-article-localized-checkbox"><span class="aui-field-content"><span class="aui-field-element aui-field-label-right"><input type="hidden" value="false" name="{portletNamespace}{instanceId}localized-checkbox"><input type="checkbox" onclick="Liferay.Util.updateCheckboxValue(this); " name="{portletNamespace}{instanceId}localized-checkboxCheckbox" id="{portletNamespace}{instanceId}localized-checkboxCheckbox" class="aui-field-input aui-field-input-choice"> </span><label for="{portletNamespace}{instanceId}localized-checkboxCheckbox" class="aui-field-label">{localizedLabelLanguage}</label></span></span><div class="journal-article-required-message portlet-msg-error">{requiredFieldLanguage}</div><div class="journal-article-buttons {articleButtonsRowCSSClass}"><span class="aui-field aui-field-inline aui-field-text journal-article-variable-name"><span class="aui-field-content"><label for="{portletNamespace}{instanceId}variableName" class="aui-field-label">{variableNameLanguage}</label><span class="aui-field-element "><input type="text" size="25" value="{variableName}" name="{portletNamespace}variableName" id="{portletNamespace}{instanceId}variableName" class="aui-field-input aui-field-input-text"></span></span></span>{editButtonTemplateHTML}{repeatableButtonTemplateHTML}</div></div><ul class="folder-droppable"></ul></span></li></div>';var n='<div id="{0}" class="journal-article-helper not-intersecting"><div class="journal-component"></div><div class="forbidden-action"></div></div>';var d='<div class="journal-article-instructions-container journal-article-instructions-message portlet-msg-info"></div>';var m="<option></option>";var r='<div class="aui-tree-placeholder aui-tree-sub-placeholder"></div>';var o='<input class="aui-field-input lfr-input-text" type="text" value="" size="40"/>';var b='<img align="top" class="journal-article-instructions-container" src="'+themeDisplay.getPathThemeImages()+'/portlet/help.png" />';var j=new l.DataSet();var a=function(u,t){var D=this;D.articleId=t;D.timers={};D.portletNamespace=u;var v=D._getNamespacedId("#structureTree");var A=l.one(v);D._helperId=D._getNamespacedId("journalArticleHelper",D.portletNamespace,"");var w=f.sub(n,[D._helperId]);D._helper=l.Node.create(w);D._helper.appendTo(document.body);D.acceptChildren=true;var B=l.Node.create(r);var z=l.all(v+" li.structure-field");D.nestedListOptions={dd:{handles:[".journal-article-move-handler"]},dropCondition:function(F){var E=F.drop.get("node");return D.canDrop(E)},dropOn:"span.folder > ul.folder-droppable",helper:D._helper,placeholder:B,sortCondition:function(F){var E=F.drop.get("node");return E.ancestor(v)},sortOn:v};D.nestedListEvents={"drag:start":function(F){var E=D._helper;E.setStyle("height","100px");E.setStyle("width","450px");D.updateTextAreaVisibility("hidden")},"drag:end":function(E){D._dropField();D.updateTextAreaVisibility("visible")},"drag:out":function(E){if(!D.acceptChildren){D.helperIntersecting();D.acceptChildren=true}},"drag:over":function(F){var E=F.drop.get("node");D.acceptChildren=D.canDrop(E);if(D.acceptChildren){D.helperIntersecting()}else{D.helperNotIntersecting()}}};D.createNestedList(z.filter(":not(.repeated-field)").filter(":not(.parent-structure-field)"),D.nestedListOptions,D.nestedListEvents);var x=D._getNamespacedId("#journalComponentList");var y=l.all(x+" .component-group .journal-component");D.componentFieldsOptions={dropCondition:function(F){var E=F.drop.get("node");return D.canDrop(E)},dropOn:"span.folder > ul.folder-droppable",helper:D._helper,placeholder:B,sortCondition:function(F){var E=F.drop.get("node");return E.ancestor(v)}};D.componentFieldsEvents={"drag:start":function(F){var I=F.target;var K=I.get("dragNode");var E=I.get("node");var M=E.text();var H=D.getComponentType(E);var J="journal-component-"+D._stripComponentType(H);var G=D._helper;var L=D._helper.all("div.journal-component");G.setStyle("height","25px");G.setStyle("width","200px");if(L){L.addClass(J).html(M)}K.addClass("component-dragging");D.updateTextAreaVisibility("hidden");D.clonedSource=E.clone();E.placeBefore(D.clonedSource);D.clonedSource.attr("id","");D.clonedSource.guid();D.clonedSource.show().setStyle("visibility","visible");D.clonedSource.removeClass("aui-helper-hidden");D.clonedSource.addClass("dragging");D.createNestedList(D.clonedSource,D.componentFieldsOptions,D.componentFieldsEvents,true)},"drag:end":function(F){var L=F.target;var E=L.get("node");var N=L.get("dragNode");var I=D.getComponentType(E);var M="journal-component-"+D._stripComponentType(I);var P=D._helper.all("div.journal-component");N.removeClass("component-dragging");if(P){P.removeClass(M).empty()}var K=A.one("div.journal-component");if(K){K.hide();var T=D._fieldInstanceFactory(I);if(T.get("fieldType")=="text_area"){D.buildHTMLEditor(T)}var Q=D._createFieldHTMLTemplate(T);var O=l.Node.create(Q);K.placeBefore(O);K.remove();var R=O.attr("dataName");var H=O.attr("dataInstanceId");T.set("source",O);T.set("variableName",R);T.set("instanceId",H);D.createNestedList(O,D.nestedListOptions,D.nestedListEvents);D._attachEvents();var G=O.get("id");j.add(G,T);D.repositionEditFieldOptions();var J=D.getById(H+"variableName");if(J){Liferay.Util.focusFormField(J);J.select()}}else{E.remove()}D.updateTextAreaVisibility("visible");if(D.clonedSource){var S=D.getById("#journalComponentList");D.clonedSource.removeClass("dragging");if(S.contains(E[0])&&S.contains(D.clonedSource[0])){E.remove()}}},"drag:out":D.nestedListEvents["drag:out"],"drag:over":D.nestedListEvents["drag:over"]};D.createNestedList(y,D.componentFieldsOptions,D.componentFieldsEvents,true);var s=D.getById("fieldLabel");var C=D.getById("#journalArticleEditFieldWrapper");if(C){C.show()}D.editContainerContextPanel=new l.OverlayContextPanel({after:{hide:l.bind(D.closeEditFieldOptions,D),show:function(){l.later(0,D,function(){Liferay.Util.focusFormField(s)})}},align:{points:["lc","rc"]},bodyContent:C,trigger:".edit-button .aui-button-input"}).render();l.OverlayContextManager.remove(D.editContainerContextPanel);D._initializeTagsSuggestionContent();D._initializePageLoadFieldInstances();D._attachEvents();D._attachEditContainerEvents();D._attachDelegatedEvents();D._updateOriginalStructureXSD()};a.prototype={addStructure:function(w,x,v,u,B,A,D){var C=this;var s="";var t=true;var z=true;var E=C.getDefaultLocale();var y=["long","java.lang.String","boolean","java.lang.String","java.util.Map<java.util.Locale, java.lang.String>","java.util.Map<java.util.Locale, java.lang.String>","java.lang.String","com.liferay.portal.service.ServiceContext"];Liferay.Service.Journal.JournalStructure.addStructure({groupId:w,structureId:x,autoStructureId:v,parentStructureId:s,nameMap:"{"+E+":"+u+"}",descriptionMap:"{"+E+":"+(B==""?null:B)+"}",xsd:A,serviceContext:l.JSON.stringify({addGroupPermissions:t,addGuestPermissions:z,scopeGroupId:w}),serviceParameterTypes:l.JSON.stringify(y)},function(F){if(f.isFunction(D)){D(F)}})},buildHTMLEditor:function(t){var s=this;var v=t.get("instanceId");var u=s.portletNamespace+"structure_el_"+v+"_content";var w=f.sub(i,{id:u,name:u});t.set("innerHTML",w);s._loadEditor(t,u);return w},buildHTMLEditorURL:function(t){var s=this;var u=a.PROXY.editorURL;u=u.replace(/LIFERAY_NAME/,l.guid());var v=a.PROXY.editorImpl;u=u.replace(/LIFERAY_SKIP_EDITOR/,Liferay.Util.isEditorPresent(v));return u},canDrop:function(u){var s=this;var t=s.getComponentType(u);var v=true;if((t=="list")||(t=="multi-list")){v=false}else{if(u.hasClass("repeated-field")||u.hasClass("parent-structure-field")){v=false}}return v},clearMessage:function(t){var s=this;var u=l.one(t);var v=s.timers[t];if(v){v.cancel()}u.hide()},closeEditFieldOptions:function(){var s=this;s.editContainerContextPanel.hide();s.unselectFields()},closeField:function(u){var s=this;if((s._hasParentField(u)||s._hasFirstLevelFields())&&confirm('\u0395\u03af\u03c3\u03c4\u03b5\u0020\u03b2\u03ad\u03b2\u03b1\u03b9\u03bf\u03b9\u0020\u03b5\u03c3\u03b5\u03af\u03c2\u0020\u03b8\u03ad\u03bb\u03b5\u03c4\u03b5\u0020\u03c4\u03b7\u0020\u03b4\u03b9\u03b1\u03b3\u03c1\u03b1\u03c6\u03ae\u0020\u03b1\u03c5\u03c4\u03cc\u03c2\u0020\u03bf\u0020\u03c4\u03bf\u03bc\u03ad\u03b1\u03c2\u0020\u03ba\u03b1\u03b9\u0020\u03cc\u03bb\u03b1\u0020\u03c4\u03b1\u0020\u03c0\u03b1\u03b9\u03b4\u03b9\u03ac\u0020\u03c4\u03b7\u03c2\u003b')){var t=s.getFieldInstance(u);t.destroy();s.closeRepeatedSiblings(u);s.closeEditFieldOptions();if(u.inDoc()){u.remove()}}},closeRepeatedSiblings:function(v){var s=this;var t=s.getFieldInstance(v);if(!t.get("repeated")){var u=s.getRepeatedSiblings(t);if(u){u.remove()}}},createNestedList:function(u,v,w,x){var s=this;var t=function(z){l.each(w,function(B,A,C){if(A&&f.isFunction(B)){z.on(A,B)}})};var y={dropOn:".folder"};v=l.merge(y,v);if(!s._nestedList){s._nestedList=new l.NestedList(v);t(s._nestedList)}if(x&&!s._nestedListComponents){s._nestedListComponents=new l.NestedList(v);t(s._nestedListComponents)}if(l.instanceOf(u,l.Node)){u=l.all(u)}u.each(function(A,z,C){var B=s._nestedList;if(x){B=s._nestedListComponents}B.add(A)})},disableEditMode:function(){var t=this;l.getBody().removeClass("portlet-journal-edit-mode");var s=t._getNamespacedId("editStructureLink");var y=l.one(s);var x=t.getById("editStructureButton");var u=t.getById("#journalComponentList");var w=t.getById("saveStructureButton");t.closeEditFieldOptions();w.ancestor(".aui-button").hide();u.hide();var v='\u0395\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03b1\u03c3\u03af\u03b1';y.show();x.ancestor(".aui-button").hide();l.all("input.journal-list-label").attr("disabled","disabled");if(t.structureChange()){var z=t.getById("structureMessage");t.showMessage(z,"alert",null,30000)}},disableFields:function(){var s=this;var t=s.getById("#journalArticleContainer");t.all("input:not(:button)").attr("disabled","disabled");t.all("textarea, select").attr("disabled","disabled")},downloadArticleContent:function(){var s=this;var v=themeDisplay.getPathMain()+"/journal/get_article_content";var u=s.getPrincipalForm("fm2");var t=s.getArticleContentXML();var w=s.getByName(u,"xml",true);if(s.structureChange()){if(confirm('\u03a0\u03c1\u03ad\u03c0\u03b5\u03b9\u0020\u03bd\u03b1\u0020\u03c3\u03ce\u03c3\u03b5\u03c4\u03b5\u0020\u03c4\u03b7\u0020\u03b4\u03bf\u03bc\u03ae\u0020\u03c0\u03c1\u03ce\u03c4\u03b1\u002e')){s.openSaveStructureDialog()}}else{u.attr("action",v);u.attr("target","_self");w.val(t);submitForm(u,null,false)}},editContainerNormalMode:function(){var s=this;var t=s.getById("#journalArticleEditFieldWrapper");t.removeClass("save-mode");s.editContainerModified=false},editContainerSaveMode:function(){var s=this;var t=s.getById("#journalArticleEditFieldWrapper");t.addClass("save-mode");s.editContainerModified=true},enableEditMode:function(){var t=this;l.getBody().addClass("portlet-journal-edit-mode");var s=t._getNamespacedId("editStructureLink");var y=l.one(s);var x=t.getById("editStructureButton");var u=t.getById("#journalComponentList");var v=t.getById("saveStructureButton");t.editContainerNormalMode();v.ancestor(".aui-button").show();u.show();var w=t.getById("#structureTree");y.hide();x.ancestor(".aui-button").show();w.all(".journal-list-label").attr("disabled","");var z=t.getById("structureMessage");t.clearMessage(z)},enableFields:function(){var s=this;var t=s.getById("#journalArticleContainer");t.all("input:not(:button)").attr("disabled","");t.all("textarea, select").attr("disabled","")},getArticleContentXML:function(){var A=this;var w=[];var t=A._getNamespacedId("#structureTree");var B=l.all(t+" > li");var u=A.hasStructure();var x;if(!u){var D=B.item(0);if(D){var E=A.getFieldInstance(D);x=E.getContent(D)}}else{var v=null;var z=[];var F=false;var s=l.all("[name="+A.portletNamespace+"available_locales]");var C=A.getDefaultLocale();A.getFields().each(function(J,H,K){var G=A.getFieldInstance(J);var I=G.get("localized");if(I){F=true}});if(F){s.each(function(I,H,J){var G=I.val();if(G){z.push(G)}});v={"available-locales":z.join(","),"default-locale":C}}else{v={"available-locales":C,"default-locale":C}}var y=A._createDynamicNode("root",v);w.push(y.openTag);B.each(function(H,G,I){A._appendStructureTypeElementAndMetaData(H,w,true)});w.push(y.closeTag);x=w.join("")}return x},getById:function(u,t){var s=this;return l.one(s._getNamespacedId(u,t))},getByName:function(w,u,v){var s=this;var t=v?u:s.portletNamespace+u;return l.one(w).one("[name="+t+"]")},getCloseButtons:function(){var s=this;return l.all("span.journal-article-close")},getComponentType:function(s){return s.attr("dataType")},getDefaultLocale:function(){var s=this;var t=s.getById("defaultLocale");if(t){t=t.val()}return t},getEditButton:function(t){var s=this;return t.one(".edit-button .aui-button-input")},getEditButtons:function(){var s=this;var t=s._getNamespacedId("#structureTree");return l.all(t+" div.journal-article-buttons .edit-button .aui-button-input")},getFieldInstance:function(t){var s=this;var u=t.get("id");return j.item(u)},getFields:function(){var s=this;var t=s._getNamespacedId("#structureTree");return l.all(t+" li")},getGroupId:function(){var s=this;var t=themeDisplay.getScopeGroupId();if(s.articleId){var u=s.getPrincipalForm();var w=s.getByName(u,"groupId");var v=w.val();if(v){t=v}}return t},getParentStructureId:function(){var s=this;var u=s.getById("parentStructureId");var t;if(u){t=u.val()}return t},getRepeatableButtons:function(){var s=this;var t=s._getNamespacedId("#structureTree");return l.all(t+" div.journal-article-buttons .repeatable-button .aui-button-input")},getRepeatedSiblings:function(u){var t=this;var v=t._getNamespacedId("#structureTree");var s=v+" li[dataName="+u.get("variableName")+"].repeated-field";return l.all(s)},getSaveDialog:function(G){var F=this;if(!F._saveDialog){var u=F.getById("saveStructureTemplateDialog");var B=u.html();var D='\u039b\u03b5\u03c0\u03c4\u03bf\u03bc\u03ad\u03c1\u03b5\u03b9\u03b5\u03c2\u0020\u03b4\u03bf\u03bc\u03ce\u03bd\u0020\u03ad\u03ba\u03b4\u03bf\u03c3\u03b7\u03c2';var t=F.getPrincipalForm();var y=F.getByName(t,"groupId");var E=F.getByName(t,"structureGroupId");var C=F.getByName(t,"structureId");var A=F.getByName(t,"structureName");var x=F.getByName(t,"structureDescription");var s=F.getByName(t,"structureXSD");var v=function(){var J=F._saveDialog.fields;F.showMessage(J.messageElement,"info",'\u0391\u03bd\u03b1\u03bc\u03bf\u03bd\u03ae\u0020\u03bc\u03b9\u03b1\u0020\u03b1\u03c0\u03ac\u03bd\u03c4\u03b7\u03c3\u03b7');var L=F.getPrincipalForm();var I=F.getByName(L,"structureId");var K=I.val();if(!K){var H=J.saveStructureAutogenerateIdCheckbox.get("checked");F.addStructure(y.val(),J.dialogStructureId.val(),H,J.dialogStructureName.val(),J.dialogDescription.val(),J.contentXSD,z)}else{F.updateStructure(J.dialogStructureGroupId.val(),J.dialogStructureId.val(),F.getParentStructureId(),J.dialogStructureName.val(),J.dialogDescription.val(),J.contentXSD,z)}};F._saveDialog=new l.Dialog({bodyContent:B,buttons:[{handler:v,label:'\u0391\u03c0\u03bf\u03b8\u03ae\u03ba\u03b5\u03c5\u03c3\u03b7'},{handler:function(){this.close()},label:'\u0386\u03ba\u03c5\u03c1\u03bf'}],centered:true,modal:true,title:D,width:550}).render();F._saveDialog.fields={autoGenerateIdMessage:'\u0391\u03c5\u03c4\u03cc\u03bc\u03b1\u03c4\u03b7\u0020\u0394\u03b7\u03bc\u03b9\u03bf\u03c5\u03c1\u03b3\u03af\u03b1\u0020\u03a4\u03b1\u03c5\u03c4\u03cc\u03c4\u03b7\u03c4\u03b1\u03c2',contentXSD:"",dialogDescription:F.getById("saveStructureStructureDescription"),dialogStructureGroupId:F.getById("saveStructureStructureGroupId"),dialogStructureId:F.getById("saveStructureStructureId"),dialogStructureName:F.getById("saveStructureStructureName"),idInput:F.getById("saveStructureStructureId"),loadDefaultStructure:F.getById("loadDefaultStructure"),messageElement:F.getById("saveStructureMessage"),saveStructureAutogenerateId:F.getById("saveStructureAutogenerateId"),saveStructureAutogenerateIdCheckbox:F.getById("saveStructureAutogenerateIdCheckbox"),showStructureIdContainer:F.getById("showStructureIdContainer"),structureIdContainer:F.getById("structureIdContainer"),structureNameLabel:F.getById("structureNameLabel")};var w=F._saveDialog.fields;var z=function(J){var I=J.exception;if(!I){x.val(w.dialogDescription.val());C.val(J.structureId);A.val(w.dialogStructureName.val());s.val(encodeURIComponent(w.contentXSD));w.dialogStructureGroupId.val(J.structureGroupId);w.dialogStructureId.val(J.structureId);w.structureNameLabel.html(w.dialogStructureName.val());w.saveStructureAutogenerateIdCheckbox.hide();if(w.loadDefaultStructure){w.loadDefaultStructure.show()}w.dialogStructureId.attr("disabled","disabled");F.showMessage(w.messageElement,"success",'\u03a4\u03bf\u0020\u03b1\u03af\u03c4\u03b7\u03bc\u03ac\u0020\u03c3\u03b1\u03c2\u0020\u03b5\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03ac\u03c3\u03c4\u03b7\u03ba\u03b5\u0020\u03b5\u03c0\u03b9\u03c4\u03c5\u03c7\u03ce\u03c2\u002e');var K=F.getById("structureMessage");K.hide()}else{var H=F._translateErrorMessage(I);F.showMessage(w.messageElement,"error",H)}};w.saveStructureAutogenerateIdCheckbox.on("click",function(H){var J=H.target;var I=J.get("checked");w.saveStructureAutogenerateId.val(I);if(I){w.dialogStructureId.attr("disabled","disabled").val(w.autoGenerateIdMessage)}else{w.dialogStructureId.attr("disabled","").val("")}});w.showStructureIdContainer.on("click",function(H){w.structureIdContainer.toggle();H.halt()});w.dialogStructureName.focus()}else{F._saveDialog.show()}if(G){G.apply(F,[F._saveDialog])}},getSelectedField:function(){var t=this;var u=null;var s=t.getFields();if(s){u=s.filter(".selected")}return u?u.item(0):null},getSourceByNode:function(t){var s=this;return t.ancestor("li",true)},getStructureXSD:function(){var s=this;var u=[];var w=s._getNamespacedId("#structureTree");var v=l.all(w+" > li.structure-field:not(.repeated-field)").filter(":not(.parent-structure-field)");var t=s._createDynamicNode("root");u.push(t.openTag);l.each(v,function(y,x,z){s._appendStructureTypeElementAndMetaData(y,u)});u.push(t.closeTag);return u.join("")},getTextAreaFields:function(){var s=this;var t=s._getNamespacedId("#structureTree");return l.all(t+" li[dataType=text_area] div.journal-article-component-container")},getPrincipalFieldElement:function(u){var s=this;var t=u.one("div.journal-article-component-container");return t.one(".aui-field-input")},getPrincipalForm:function(t){var s=this;return l.one("form[name="+s.portletNamespace+(t||"fm1")+"]")},getNodeTypeContent:function(){var s=this;return s.hasStructure()?"dynamic-content":"static-content"},hasStructure:function(){var s=this;var u=s.getPrincipalForm();var t=s.getByName(u,"structureId");return t&&t.val()},hasTemplate:function(){var s=this;var u=s.getPrincipalForm();var t=s.getByName(u,"templateId");return t&&t.val()},helperIntersecting:function(){var s=this;s._helper.removeClass("not-intersecting")},helperNotIntersecting:function(t){var s=this;s._helper.addClass("not-intersecting")},hideEditContainerMessage:function(){var t=this;var s=t._getNamespacedId("journalMessage");l.one(s).hide()},loadDefaultStructure:function(){var s=this;var v=s.getPrincipalForm();var u=s.getByName(v,"structureId");var t=s.getByName(v,"templateId");var w=s.getByName(v,"content");u.val("");t.val("");w.val("");submitForm(v)},loadEditFieldOptions:function(t){var D=this;var F=D.getFieldInstance(t);var v=function(G,H){var K=G.get("id");var J=l.one("#"+K+"Checkbox");var I=l.DataType.Boolean.parse(H);G.val(I);if(J){J.set("checked",I)}};if(F){var C=D.getById("#journalArticleEditFieldWrapper");var B=D.getById("displayAsTooltip");var E=D.getById("repeatable");var y=D.getById("fieldType");var x=D.getById("indexType");var w=D.getById("instructions");var A=D.getById("predefinedValue");var z=D.getById("required");var u=D.getById("fieldLabel");y.val(F.get("fieldType"));x.val(F.get("indexType"));v(B,F.get("displayAsTooltip"));v(E,F.get("repeatable"));v(z,F.get("required"));u.val(F.get("fieldLabel"));w.val(F.get("instructions"));A.val(F.get("predefinedValue"));var s=C.all("input[type=text], select:not([name$=fieldType]), textarea, input[type=checkbox]");if(F.get("repeated")||F.get("parentStructureId")){s.attr("disabled","disabled")}else{s.attr("disabled","")}}},normalizeValue:function(t){var s=this;if(f.isUndefined(t)){t=""}return t},openPopupWindow:function(s,t){Liferay.Util.openWindow({dialog:{align:Liferay.Util.Window.ALIGN_CENTER,width:680},title:t,uri:s})},openSaveStructureDialog:function(){var s=this;var x=s.getPrincipalForm();var t=s.getByName(x,"structureId");var u=s.getByName(x,"structureName");var w=s.getByName(x,"structureDescription");var v=t.val();s.getSaveDialog(function(z){var y=z.fields;y.contentXSD=s.getStructureXSD();y.dialogStructureName.val(u.val());y.dialogDescription.val(w.val());y.dialogStructureId.attr("disabled","disabled").val(y.autoGenerateIdMessage);if(v){y.saveStructureAutogenerateId.hide();y.dialogStructureId.val(t.val())}z.show();z._setAlignCenter(true)})},previewArticle:function(){var D=this;var t=D.getPrincipalForm();var x=D.getPrincipalForm("fm2");var F=D.getArticleContentXML();if(D.structureChange()){if(confirm('\u03a0\u03c1\u03ad\u03c0\u03b5\u03b9\u0020\u03bd\u03b1\u0020\u03c3\u03ce\u03c3\u03b5\u03c4\u03b5\u0020\u03c4\u03b7\u0020\u03b4\u03bf\u03bc\u03ae\u0020\u03c0\u03c1\u03ce\u03c4\u03b1\u002e')){D.openSaveStructureDialog()}}else{if(D.hasStructure()&&!D.hasTemplate()&&!D.updateStructureDefaultValues()){var B='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03c0\u03c1\u03bf\u03c3\u03b8\u03ad\u03c3\u03c4\u03b5\u0020\u03ad\u03bd\u03b1\u0020\u03c0\u03c1\u03cc\u03c4\u03c5\u03c0\u03bf\u0020\u03b3\u03b9\u03b1\u0020\u03bd\u03b1\u0020\u03b4\u03ce\u03c3\u03b5\u03c4\u03b5\u0020\u03b1\u03c5\u03c4\u03ae\u03bd\u0020\u03c4\u03b7\u03bd\u0020\u03b4\u03bf\u03bc\u03ae\u002e';alert(B);D.showMessage("#selectTemplateMessage","info",B,30000);D.getById("selectTemplateButton").focus()}else{var E=D.getDefaultLocale();var C=D.getByName(t,"type");var u=D.getByName(t,"version");var A=D.getByName(t,"structureId");var v=D.getByName(t,"templateId");var s=themeDisplay.getPathMain()+"/journal/view_article_content?cmd=preview&groupId="+D.getGroupId()+"&articleId="+D.articleId+"&version="+u.val()+"&languageId="+E+"&type="+C.val()+"&structureId="+A.val()+"&templateId="+v.val();x.attr("action",s);x.attr("target","_blank");var w=D.getByName(t,"title_"+E);var z=D.getByName(x,"title",true);var y=D.getByName(x,"xml",true);z.val(w.val());y.val(F);submitForm(x,null,false)}}},renderEditFieldOptions:function(v){var t=this;var u=t.getEditButton(v);var s=t.getFields();t.editContainerNormalMode();s.removeClass("selected");v.addClass("selected");if(t._lastEditContainerTrigger!=u){t.editContainerContextPanel.set("trigger",u);t.editContainerContextPanel.show();t._lastEditContainerTrigger=u}t.hideEditContainerMessage();t.loadEditFieldOptions(v);t.editContainerContextPanel.refreshAlign()},repeatField:function(u){var s=this;var w=function(B,E){var z=s.getFieldInstance(B).clone();var D=g();E.addClass("repeated-field");E.removeClass("yui-dd-drop yui-dd-draggable");var A=E.resetId().get("id");j.add(A,z);z.set("source",E);z.set("instanceId",D);var x=z.get("fieldType");if(x=="text_area"){var C=s.buildHTMLEditor(z);var y=E.one(".journal-article-component-container");y.html(C)}else{if(x=="image"){E.all(".journal-image-show-hide,.journal-image-preview").remove()}}return z};var v=u.clone();u.placeAfter(v);w(u,v);var t=v.all(".structure-field");t.each(function(y){var x=w(y,y)});s._attachEvents()},repositionEditFieldOptions:function(){var t=this;var u=t.getById("#journalArticleEditFieldWrapper");var s=!u.ancestor(".aui-overlaycontextpanel-hidden");if(s){setTimeout(function(){var v=t.getSelectedField();t.renderEditFieldOptions(v)},200)}},saveArticle:function(u){var C=this;var t=C.getPrincipalForm();if(C.structureChange()){if(confirm('\u03a0\u03c1\u03ad\u03c0\u03b5\u03b9\u0020\u03bd\u03b1\u0020\u03c3\u03ce\u03c3\u03b5\u03c4\u03b5\u0020\u03c4\u03b7\u0020\u03b4\u03bf\u03bc\u03ae\u0020\u03c0\u03c1\u03ce\u03c4\u03b1\u002e')){C.openSaveStructureDialog()}}else{if(C.hasStructure()&&!C.hasTemplate()&&!C.updateStructureDefaultValues()){var B='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03c0\u03c1\u03bf\u03c3\u03b8\u03ad\u03c3\u03c4\u03b5\u0020\u03ad\u03bd\u03b1\u0020\u03c0\u03c1\u03cc\u03c4\u03c5\u03c0\u03bf\u0020\u03b3\u03b9\u03b1\u0020\u03bd\u03b1\u0020\u03b4\u03ce\u03c3\u03b5\u03c4\u03b5\u0020\u03b1\u03c5\u03c4\u03ae\u03bd\u0020\u03c4\u03b7\u03bd\u0020\u03b4\u03bf\u03bc\u03ae\u002e';alert(B);C.showMessage("#selectTemplateMessage","info",B,30000);C.getById("selectTemplateButton").focus()}else{if(!u){u=C.articleId?"update":"add"}var x=C.getByName(t,"cmd");var v=C.getByName(t,"newArticleId");var A=C.getByName(t,"articleId");var z=C.getByName(t,"content");var w=C.getByName(t,"workflowAction");var s=C.validateRequiredFields();if(s){if(u=="publish"){w.val(Liferay.Workflow.ACTION_PUBLISH);u=C.articleId?"update":"add"}x.val(u);if(!C.articleId){A.val(v.val())}var y=C.getArticleContentXML();z.val(y);submitForm(t)}}}},saveEditFieldOptions:function(s){var G=this;var I=G.getFieldInstance(s);if(I){var F=G.getById("displayAsTooltip");var B=G.getById("displayAsTooltipCheckbox");var H=G.getById("repeatable");var t=G.getById("repeatableCheckbox");var A=G.getById("fieldType");var y=G.getById("indexType");var x=G.getById("instructions");var E=G.getById("predefinedValue");var D=G.getById("required");var w=G.getById("requiredCheckbox");var u=G.getById("fieldLabel");var z=s.one(".journal-article-localized");var v="";if(z){v=z.val()}var C=G.getById("journalMessage");l.each({displayAsTooltip:B.attr("checked"),fieldType:A.val(),indexType:y.val(),instructions:x.val(),localizedValue:v,predefinedValue:E.val(),repeatable:t.attr("checked"),required:w.attr("checked")},function(K,J,L){I.set(J,K)});G.updateFieldLabelName(I,u.val());G.showMessage(C,"success",'\u03a4\u03bf\u0020\u03b1\u03af\u03c4\u03b7\u03bc\u03ac\u0020\u03c3\u03b1\u03c2\u0020\u03b5\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03ac\u03c3\u03c4\u03b7\u03ba\u03b5\u0020\u03b5\u03c0\u03b9\u03c4\u03c5\u03c7\u03ce\u03c2\u002e');G.editContainerNormalMode()}},showMessage:function(t,x,y,u){var s=this;var v=l.one(t);var w="save-structure-message portlet-msg-"+(x||"success");v.attr("className",w);v.show();s.editContainerContextPanel.refreshAlign();if(y){v.html(y)}s.timers[t]=l.later(u||5000,s,function(){v.hide();s.editContainerContextPanel.refreshAlign()})},structureChange:function(w){var s=this;var v=s.getPrincipalForm();var t=s.getByName(v,"structureXSD").val();var u=(t!=encodeURIComponent(s.getStructureXSD()));return u},translateArticle:function(){var s=this;var v=s.getPrincipalForm();var t=s.getByName(v,"cmd");t.val("translate");var w=s.getByName(v,"content");var u=s.getArticleContentXML();w.val(u);submitForm(v)},unselectFields:function(){var s=this;var t=s.getSelectedField();if(t){t.removeClass("selected")}},updateFieldLabelName:function(t,v){var s=this;var u=s.getRepeatedSiblings(t);u.each(function(x,w,z){var y=s.getFieldInstance(x);y.set("fieldLabel",v)});t.set("fieldLabel",v)},updateFieldVariableName:function(t,v){var s=this;var u=s.getRepeatedSiblings(t);u.each(function(x,w,z){var y=s.getFieldInstance(x);y.set("variableName",v)});t.set("variableName",v)},updateStructure:function(u,v,s,t,y,x,A){var z=this;var B=z.getDefaultLocale();var w=["long","java.lang.String","java.lang.String","java.util.Map<java.util.Locale, java.lang.String>","java.util.Map<java.util.Locale, java.lang.String>","java.lang.String","com.liferay.portal.service.ServiceContext"];Liferay.Service.Journal.JournalStructure.updateStructure({groupId:u,structureId:v,parentStructureId:s||"",nameMap:"{"+B+":"+t+"}",descriptionMap:"{"+B+":"+(y==""?null:y)+"}",xsd:x,serviceContext:l.JSON.stringify({scopeGroupId:u}),serviceParameterTypes:l.JSON.stringify(w)},function(C){if(f.isFunction(A)){A(C)}})},updateStructureDefaultValues:function(){var s=this;var u=s.getPrincipalForm();var t=s.getByName(u,"classNameId");return(t&&t.val()>0)},updateTextAreaVisibility:function(t){var s=this;var u=s.getTextAreaFields();if(u){u.setStyle("visibility",t)}},validateRequiredFields:function(){var t=this;var w=true;var y=t._getNamespacedId("#structureTree");var s=l.all(y+" li");var v=s.filter("[dataRequired=true]");var u=l.all(y+" li .field-container");var x=null;u.removeClass("required-field");l.each(v,function(C,A,E){var z=t.getFieldInstance(C);var B=z.getContent(C);if(!B){var D=C.one(".field-container");D.addClass("required-field");if(w){x=t.getPrincipalFieldElement(C)}w=false}});if(x){x.focus()}return w},_appendStructureChildren:function(x,v,u){var t=this;var s="> span.folder > ul > li";if(!u){s+=".structure-field:not(.repeated-field):not(.parent-structure-field)"}var w=x.all(s);l.each(w,function(z,y,A){t._appendStructureTypeElementAndMetaData(z,v,u)})},_appendStructureTypeElementAndMetaData:function(H,L,F){var Q=this;var N=Q.getFieldInstance(H);if(N){var J;var y=N.get("fieldType");var A=N.get("indexType");if(F){var P=N.get("instanceId");if(!P){P=g();N.set("instanceId",P)}J=Q._createDynamicNode("dynamic-element",{"instance-id":P,name:encodeURI(N.get("variableName")),type:y,"index-type":A})}else{J=Q._createDynamicNode("dynamic-element",{name:encodeURI(N.get("variableName")),type:y,"index-type":A,repeatable:N.get("repeatable")})}var t=null;if(N.get("localized")){var R=N.get("localizedValue");if(R!=="false"){t={"language-id":R}}}var I=Q.getNodeTypeContent();var B=Q._createDynamicNode(I,t);var E=Q._createDynamicNode("meta-data");var v=Q._createDynamicNode("entry",{name:"instructions"});var z=Q._createDynamicNode("entry",{name:"required"});var G=Q._createDynamicNode("entry",{name:"displayAsTooltip"});var C=Q._createDynamicNode("entry",{name:"label"});var w=Q._createDynamicNode("entry",{name:"predefinedValue"});L.push(J.openTag);if(!F){Q._appendStructureFieldOptionsBuffer(H,L)}Q._appendStructureChildren(H,L,F);if(!F){L.push(E.openTag);var D=Q.normalizeValue(N.get("displayAsTooltip"));L.push(G.openTag,"<![CDATA["+D+"]]>",G.closeTag);var x=Q.normalizeValue(N.get("required"));L.push(z.openTag,"<![CDATA["+x+"]]>",z.closeTag);var s=Q.normalizeValue(N.get("instructions"));L.push(v.openTag,"<![CDATA["+s+"]]>",v.closeTag);var M=Q.normalizeValue(N.get("fieldLabel"));L.push(C.openTag,"<![CDATA["+M+"]]>",C.closeTag);var u=Q.normalizeValue(N.get("predefinedValue"));L.push(w.openTag,"<![CDATA["+u+"]]>",w.closeTag,E.closeTag)}else{if(F){L.push(B.openTag);var O=(y=="list")||(y=="multi-list");if(O){Q._appendStructureFieldOptionsBuffer(H,L,F)}else{var K=N.getContent(H)||"";L.push("<![CDATA["+K+"]]>")}L.push(B.closeTag)}}L.push(J.closeTag)}},_appendStructureFieldOptionsBuffer:function(x,u,t){var s=this;var v=s.getFieldInstance(x);var w=v.get("fieldType");var y=x.all("> .folder > .field-container > .journal-article-component-container > .journal-list-subfield option");if(y){l.each(y,function(D,B,E){var z=s._formatOptionsKey(D.text());var G=D.val();if(!t){var F=s._createDynamicNode("dynamic-element",{name:z,type:G,repeatable:v.get("repeatable")});u.push(F.openTag+F.closeTag)}else{if(D.get("selected")){var A=(w=="multi-list");var C=s._createDynamicNode("option");if(A){u.push(C.openTag)}u.push("<![CDATA["+Liferay.Util.escapeCDATA(G)+"]]>");if(A){u.push(C.closeTag)}}}})}},_attachDelegatedEvents:function(){var t=this;var y=t._getNamespacedId("#journalArticleContainer");var w=function(z){var D=z.currentTarget;var C=D.get("parentNode");var E=C.get("parentNode").one("select");var A=C.one("input.journal-list-key");var G=t._formatOptionsKey(A.val());var H=C.one("input.journal-list-value");var F=H.val();if(G&&F){var I=E.all("option");I.each(function(M,L,N){var J=f.trim(G);var K=f.trim(M.text());if(K.toLowerCase()==J.toLowerCase()){M.remove()}});var B=l.Node.create(m).val(F).text(G);E.append(B);B.attr("selected","selected");A.val("").focus();H.val("value")}else{A.focus()}};var v=function(A){var z=A.currentTarget.get("parentNode").one("span.journal-add-field");if(A.isKey("ENTER")){A.currentTarget=z;w.apply(A.currentTarget,arguments)}};var x=function(C){var B=C.currentTarget;var z=B.get("parentNode").one("select").focus();var A=z.all("option");A.each(function(E,D,F){if(E.attr("selected")){E.remove()}})};var u=l.one(y);u.delegate("click",function(z){var B=z.currentTarget;var A=t.getSourceByNode(B);t._updateLocaleState(A,B)},".journal-article-localized-checkbox .aui-field-input-choice");u.delegate("click",function(z){var A=t.getSourceByNode(z.currentTarget);t.repeatField(A)},".repeatable-field-add");u.delegate("click",function(z){var A=t.getSourceByNode(z.currentTarget);t.closeField(A)},".repeatable-field-delete");u.delegate("mouseenter",function(z){var A=t.getSourceByNode(z.currentTarget);A.addClass("repeatable-border")},".repeatable-field-image");u.delegate("mouseleave",function(z){var A=t.getSourceByNode(z.currentTarget);A.removeClass("repeatable-border")},".repeatable-field-image");u.delegate("keypress",v,".journal-list-key");u.delegate("keypress",v,".journal-list-value");u.delegate("click",w,".journal-add-field");u.delegate("click",x,".journal-delete-field");u.delegate("click",function(D){var B=D.currentTarget;var z=null;var A=B.ancestor(".journal-image-preview");var C=A.one(".journal-image-wrapper");var E=t.getByName(A,"journalImageDelete");if(E.val()==""){E.val("delete");C.hide();z='\u0386\u03ba\u03c5\u03c1\u03bf'}else{E.val("");C.show();z='\u0394\u03b9\u03b1\u03b3\u03c1\u03b1\u03c6\u03ae'}B.val(z)},"#"+t.portletNamespace+"journalImageDeleteButton");u.delegate("click",function(D){var C=D.currentTarget;var z=C.get("parentNode").get("parentNode").one(".journal-image-preview");var A=C.one(".show-label").show();var B=C.one(".hide-label").show();var E=z.hasClass("aui-helper-hidden");if(E){A.hide();B.show()}else{A.show();B.hide()}z.toggle()},".journal-image-link");u.delegate("click",function(C){var A=C.currentTarget;var z=A.ancestor(".journal-article-component-container").one(".aui-field-input");var B=A.attr("data-documentlibraryUrl");window[t.portletNamespace+"selectDocumentLibrary"]=function(D){z.val(D)};t.openPopupWindow(B,'\u0388\u03b3\u03b3\u03c1\u03b1\u03c6\u03b1\u0020\u03ba\u03b1\u03b9\u0020\u006d\u0065\u0064\u0069\u0061')},".journal-documentlibrary-button .aui-button-input");u.delegate("mouseover",function(B){var D=B.currentTarget;var C=t.getSourceByNode(D);var A=t.getFieldInstance(C);if(A){var z=A.get("instructions");Liferay.Portal.ToolTip.show(this,z)}},"img.journal-article-instructions-container");var s='[name="'+t.portletNamespace+'variableName"]';u.delegate("keypress",l.bind(t._onKeypressVariableName,t),s);u.delegate("keyup",l.bind(t._onKeyupVariableName,t),s)},_attachEditContainerEvents:function(v){var C=this;var B=C.getById("#journalArticleEditFieldWrapper");if(B){var z=B.all("input[type=checkbox]");var s=B.all("input[type=text],select");var w=B.all("textarea");var A=B.one(".cancel-button .aui-button-input");var x=B.one(".close-button .aui-button-input");var u=B.one(".save-button .aui-button-input");var t=C.getById("journalArticleWrapper");z.detach("click");s.detach("change");s.detach("keypress");w.detach("change");w.detach("keypress");A.detach("click");x.detach("click");u.detach("click");var y=C.editContainerSaveMode;z.on("click",y,C);s.on("change",y,C);s.on("keypress",y,C);w.on("change",y,C);w.on("keypress",y,C);u.on("click",function(){var E=C.getSelectedField();C.saveEditFieldOptions(E)});var D=C.closeEditFieldOptions;A.on("click",D,C);x.on("click",D,C)}},_attachEvents:function(){var H=this;var F=H.getCloseButtons();var C=H.getEditButtons();var z=H.getRepeatableButtons();var s=H.getById("downloadArticleContentButton");var y=H.getById("journalArticleContainer");var B=H.getById("previewArticleButton");var v=H.getById("publishButton");var t=H.getById("saveButton");var E=H.getById("translateButton");var u=y.all(".journal-article-component-container .aui-field-input");F.detach("click");u.detach("change");C.detach("click");z.detach("click");if(v){v.detach("click")}if(t){t.detach("click")}if(E){E.detach("click")}C.on("click",function(L){var M=H.getSourceByNode(L.currentTarget);H.renderEditFieldOptions(M)});z.on("click",function(L){var M=H.getSourceByNode(L.currentTarget);H.repeatField(M)});F.on("click",function(L){var M=H.getSourceByNode(L.currentTarget);H.closeField(M)});if(t){t.on("click",function(){H.saveArticle()})}if(v){v.on("click",function(){H.saveArticle("publish")})}if(E){E.on("click",function(){H.translateArticle()})}if(s){s.detach("click");s.on("click",function(){H.downloadArticleContent()})}if(B){B.detach("click");B.on("click",function(){H.previewArticle()})}var A=H.getById("changeStructureButton");var w=H._getNamespacedId("editStructureLink");var G=l.one(w);var K=H.getById("editStructureButton");var I=H.getById("loadDefaultStructure");var D=H.getById("saveStructureButton");var J=l.one(".journal-save-structure-trigger");if(A){A.detach("click");A.on("click",function(M){M.preventDefault();var L=M.currentTarget.attr("href");H.openPopupWindow(L,"ChangeStructure")})}if(I){I.detach("click");I.on("click",function(){H.loadDefaultStructure()})}if(D){D.detach("click");D.on("click",function(){H.openSaveStructureDialog()})}if(J){J.detach("click");J.on("click",function(L){L.preventDefault();D.simulate("click")})}var x=l.getBody();if(K){K.detach("click");K.on("click",function(L){Liferay.reset("controlPanelSidebarHidden");H.disableEditMode()})}if(G){G.detach("click");G.on("click",function(L){Liferay.set("controlPanelSidebarHidden",true);H.enableEditMode()})}},_createDynamicNode:function(x,t){var s=this;var u=[];var w=[];if(!x){x="dynamic-element"}var v=["<",x,(t?" ":""),,">",,"</",x,">"];l.each(t||{},function(z,y,A){if(z!==undefined){u.push([y,'="',z,'" '].join(""))}});v[3]=u.join("").replace(/[\s]+$/g,"");w=v.join("").replace(/></,">><<").replace(/ +>/,">").split(/></);return{closeTag:w[1],openTag:w[0]}},_createFieldHTMLTemplate:function(v){var s=this;var w=v.getFieldContainer();var t=v.getFieldElementContainer();var x=v.get("innerHTML");var u=v.get("fieldType");t.html(x);return w.html()},_dropField:function(){var s=this;s.repositionEditFieldOptions()},_fieldInstanceFactory:function(v){var s=this;var w;if(f.isString(v)){w=v;v=null}else{w=v.fieldType}v=v||{};var u={"boolean":a.FieldModel.Boolean,document_library:a.FieldModel.DocumentLibrary,image:a.FieldModel.Image,link_to_layout:a.FieldModel.LinkToPage,list:a.FieldModel.List,"multi-list":a.FieldModel.MultiList,selection_break:a.FieldModel.SelectionBreak,text:a.FieldModel.Text,text_area:a.FieldModel.TextArea,text_box:a.FieldModel.TextBox};v=l.merge(u[w],v);var t=new a.StructureField(v,s.portletNamespace).render();t.get("fieldLabel");return t},_formatOptionsKey:function(t){return t.replace(/\W+/g," ").replace(/^\W+|\W+$/g,"").replace(/ /g,"_")},_getNamespacedId:function(v,t,u){var s=this;if(!f.isString(t)){t=s.portletNamespace}if(!f.isString(u)){u="#"}v=v.replace(/^#/,"");return u+t+v},_hasFirstLevelFields:function(){var s=this;var t=l.all(s._getNamespacedId("#structureTree")+"> li");return(t&&t.size()>1)},_hasParentField:function(v){var s=this;var t=s.getFieldInstance(v);var w=v.get("id");var u=l.one("#"+w);return u&&u.ancestor().hasClass("folder-droppable")},_initializePageLoadFieldInstances:function(){var t=this;var s=t.getFields();s.each(function(L,z,F){var J=t.getFieldInstance(L);if(!J){var C=L.attr("dataName");var H=L.attr("dataType");var E=L.attr("dataDisplayAsTooltip");var u=L.attr("dataLabel");var x=L.attr("dataIndexType");var K=L.attr("dataInstanceId");var v=L.attr("dataInstructions");var A=L.one(".journal-article-localized");var D=L.attr("dataParentStructureId");var w=L.attr("dataPredefinedValue");var y=L.attr("dataRepeatable");var B=L.attr("dataRequired");var M;if(A){M=A.val()}var I=(String(M)!="false");J=t._fieldInstanceFactory({displayAsTooltip:E,fieldLabel:u,instanceId:K,instructions:v,localized:I,localizedValue:M,parentStructureId:D,predefinedValue:w,repeatable:y,required:B,source:L,fieldType:H,indexType:x,variableName:C})}var G=L.get("id");j.add(G,J)})},_initializeTagsSuggestionContent:function(){var s=this;window[s.portletNamespace+"getSuggestionsContent"]=function(){var t=[];s.getFields().each(function(w,v,y){var u=s.getFieldInstance(w);var x=u.getContent(w);t.push(x)});return t.join(" ")}},_loadEditor:function(t,v){var s=this;var u=s.buildHTMLEditorURL(t);l.io.request(u,{method:"GET",on:{success:function(y,A,z){var x=this.get("responseData");var w=l.one("#"+v);w.plug(l.Plugin.ParseContent);w.setContent(x)}}})},_onKeyupVariableName:function(v){var s=this;var u=v.currentTarget;var w=s.getSourceByNode(u);var t=s.getFieldInstance(w);if(t){var x=u.val();s.updateFieldVariableName(t,x)}},_onKeypressVariableName:function(u){var s=this;if(!u.isKeyInSet("BACKSPACE","DELETE","LEFT","RIGHT")){var t=/^[\w_-]$/;var v=String.fromCharCode(u.keyCode);if(!t.test(v)){u.halt()}}},_stripComponentType:function(s){return s.toLowerCase().replace(/[^a-z]+/g,"")},_translateErrorMessage:function(t){var s="";if(t.indexOf("StructureXsdException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03ad\u03bd\u03b1\u03bd\u0020\u03ad\u03b3\u03ba\u03c5\u03c1\u03bf\u0020\u03ba\u03b1\u03b8\u03bf\u03c1\u03b9\u03c3\u03bc\u03cc\u0020\u03c3\u03c7\u03b7\u03bc\u03ac\u03c4\u03c9\u03bd\u0020\u0058\u004d\u004c\u0020\u0028\u0058\u0053\u0044\u0029\u002e'}else{if(t.indexOf("DuplicateStructureElementException")>-1){s=Liferay.Language.get("please-enter-unique-structure-field-names-(including-field-names-inherited-from-the-parent-structure)")}else{if(t.indexOf("DuplicateStructureIdException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03bc\u03b9\u03b1\u0020\u03bc\u03bf\u03bd\u03b1\u03b4\u03b9\u03ba\u03ae\u0020\u03c4\u03b1\u03c5\u03c4\u03cc\u03c4\u03b7\u03c4\u03b1\u002e'}else{if(t.indexOf("StructureDescriptionException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03bc\u03b9\u03b1\u0020\u03ad\u03b3\u03ba\u03c5\u03c1\u03b7\u0020\u03c0\u03b5\u03c1\u03b9\u03b3\u03c1\u03b1\u03c6\u03ae\u002e'}else{if(t.indexOf("StructureIdException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03bc\u03b9\u03b1\u0020\u03ad\u03b3\u03ba\u03c5\u03c1\u03b7\u0020\u03c4\u03b1\u03c5\u03c4\u03cc\u03c4\u03b7\u03c4\u03b1\u002e'}else{if(t.indexOf("StructureInheritanceException")>-1){s='\u0391\u03c5\u03c4\u03ae\u0020\u03b7\u0020\u03b4\u03bf\u03bc\u03ae\u0020\u03b5\u03af\u03bd\u03b1\u03b9\u0020\u03ae\u03b4\u03b7\u0020\u03bc\u03ad\u03c3\u03b1\u0020\u03c3\u03c4\u03b7\u03bd\u0020\u03c0\u03bf\u03c1\u03b5\u03af\u03b1\u0020\u03ba\u03bb\u03b7\u03c1\u03bf\u03bd\u03bf\u03bc\u03b9\u03ac\u03c2\u0020\u03c4\u03bf\u03c5\u0020\u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03bf\u03c5\u0020\u03b3\u03bf\u03bd\u03ad\u03b1\u002e\u0020\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03c0\u03b9\u03bb\u03ad\u03be\u03c4\u03b5\u0020\u03bc\u03b9\u03b1\u0020\u03ac\u03bb\u03bb\u03b7\u0020\u03b4\u03bf\u03bc\u03ae\u0020\u03b3\u03bf\u03bd\u03ad\u03c9\u03bd\u002e'}else{if(t.indexOf("StructureNameException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03ad\u03bd\u03b1\u0020\u03ad\u03b3\u03ba\u03c5\u03c1\u03bf\u0020\u03cc\u03bd\u03bf\u03bc\u03b1\u002e'}else{if(t.indexOf("NoSuchStructureException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03bc\u03b9\u03b1\u0020\u03ad\u03b3\u03ba\u03c5\u03c1\u03b7\u0020\u03c4\u03b1\u03c5\u03c4\u03cc\u03c4\u03b7\u03c4\u03b1\u002e'}else{if(t.indexOf("ArticleContentException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03ad\u03b3\u03ba\u03c5\u03c1\u03bf\u0020\u03c0\u03b5\u03c1\u03b9\u03b5\u03c7\u03cc\u03bc\u03b5\u03bd\u03bf\u002e'}else{if(t.indexOf("ArticleIdException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03bc\u03b9\u03b1\u0020\u03ad\u03b3\u03ba\u03c5\u03c1\u03b7\u0020\u03c4\u03b1\u03c5\u03c4\u03cc\u03c4\u03b7\u03c4\u03b1\u002e'}else{if(t.indexOf("ArticleTitleException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03ad\u03bd\u03b1\u0020\u03ad\u03b3\u03ba\u03c5\u03c1\u03bf\u0020\u03cc\u03bd\u03bf\u03bc\u03b1\u002e'}else{if(t.indexOf("DuplicateArticleIdException")>-1){s='\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce\u0020\u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5\u0020\u03bc\u03b9\u03b1\u0020\u03bc\u03bf\u03bd\u03b1\u03b4\u03b9\u03ba\u03ae\u0020\u03c4\u03b1\u03c5\u03c4\u03cc\u03c4\u03b7\u03c4\u03b1\u002e'}}}}}}}}}}}}return s},_updateLocaleState:function(s,w){var y=this;var t=w.get("checked");var A=y.getDefaultLocale();var u=s.one(".journal-article-localized");var x=A;var v=function(B){if(u){u.val(B)}};if(t){v(x)}else{if(!confirm('\u03a4\u03bf\u0020\u0055\u006e\u0063\u0068\u0065\u0063\u006b\u0069\u006e\u0067\u0020\u03b1\u03c5\u03c4\u03cc\u03c2\u0020\u03bf\u0020\u03c4\u03bf\u03bc\u03ad\u03b1\u03c2\u0020\u03b8\u03b1\u0020\u03b1\u03c6\u03b1\u03b9\u03c1\u03ad\u03c3\u03b5\u03b9\u0020\u03c4\u03b1\u0020\u03b5\u03bd\u03c4\u03bf\u03c0\u03b9\u03c3\u03bc\u03ad\u03bd\u03b1\u0020\u03c3\u03c4\u03bf\u03b9\u03c7\u03b5\u03af\u03b1\u0020\u03b3\u03b9\u03b1\u0020\u03c4\u03b9\u03c2\u0020\u03b3\u03bb\u03ce\u03c3\u03c3\u03b5\u03c2\u0020\u03c0\u03bf\u03c5\u0020\u03b4\u03b5\u03bd\u0020\u03c0\u03b1\u03c1\u03bf\u03c5\u03c3\u03b9\u03ac\u03b6\u03bf\u03bd\u03c4\u03b1\u03b9\u0020\u03ba\u03b1\u03c4\u03ac\u0020\u03b1\u03c5\u03c4\u03ae\u03bd\u0020\u03c4\u03b7\u03bd\u0020\u03ac\u03c0\u03bf\u03c8\u03b7\u002e\u0020\u0398\u03ad\u03bb\u03b5\u03c4\u03b5\u0020\u03bd\u03b1\u0020\u03c0\u03c1\u03bf\u03c7\u03c9\u03c1\u03ae\u03c3\u03b5\u03c4\u03b5\u003b')){w.attr("checked",true);v(x)}else{v(false)}}var z=y.getFieldInstance(s);z.set("localized",w.get("checked"));z.setInstanceId(z.get("instanceId"))},_updateOriginalStructureXSD:function(){var s=this;var u=s.getPrincipalForm();var v=encodeURIComponent(s.getStructureXSD());var t=s.getByName(u,"structureXSD");if(t){t.val(v)}}};var e=l.Component.create({ATTRS:{content:{validator:f.isString,value:""},displayAsTooltip:{setter:function(t){var s=this;return s.setAttribute("displayAsTooltip",h.Boolean.parse(t))},valueFn:function(){var s=this;return s.getAttribute("displayAsTooltip",true)}},fieldLabel:{setter:function(t){var s=this;return s.setFieldLabel(t)},valueFn:function(){var s=this;return s.getAttribute("fieldLabel","")}},fieldType:{setter:function(t){var s=this;return s.setAttribute("fieldType",t)},validator:f.isString,value:""},localized:{valueFn:function(){var s=this;var t=s.getLocalizedValue();return(String(t)=="true")}},localizedValue:{getter:function(){var s=this;return s.getLocalizedValue()}},indexType:{setter:function(t){var s=this;return s.setAttribute("IndexType",t)},valueFn:function(){var s=this;return s.getAttribute("IndexType","")}},innerHTML:{validator:f.isString,value:o},instructions:{setter:function(t){var s=this;return s.setInstructions(t)},valueFn:function(){var s=this;return s.getAttribute("instructions","")}},instanceId:{setter:function(t){var s=this;return s.setInstanceId(t)},valueFn:function(){var s=this;var t=g();return s.getAttribute("instanceId",t)}},optionsEditable:{validator:f.isBoolean,value:true},parentStructureId:{setter:function(t){var s=this;return s.setAttribute("parentStructureId",t)},valueFn:function(){var s=this;return s.getAttribute("parentStructureId","")}},predefinedValue:{setter:function(t){var s=this;return s.setAttribute("predefinedValue",t)},valueFn:function(){var s=this;return s.getAttribute("predefinedValue","")}},repeatable:{setter:function(t){var s=this;return s.setRepeatable(h.Boolean.parse(t))},valueFn:function(){var s=this;return s.getAttribute("repeatable",false)}},repeated:{getter:function(){var s=this;return s.get("source").hasClass("repeated-field")}},required:{setter:function(t){var s=this;return s.setAttribute("required",h.Boolean.parse(t))},valueFn:function(){var s=this;return s.getAttribute("required",false)}},source:{value:null},variableName:{setter:function(t){var s=this;return s.setVariableName(t)},validator:f.isString,valueFn:function(){var s=this;return s.getAttribute("name")}}},EXTENDS:l.Widget,NAME:"structurefield",constructor:function(t,u){var s=this;s._lazyAddAttrs=false;s.portletNamespace=u;e.superclass.constructor.apply(this,arguments)},UI_ATTRS:["optionsEditable"],prototype:{cloneableAttrs:["displayAsTooltip","fieldLabel","fieldType","indexType","innerHTML","instructions","localized","localizedValue","predefinedValue","repeatable","required","variableName"],initializer:function(){var t=this;var s=t.propagateAttr;l.each(t.cloneableAttrs,function(v,u,w){t.after(v+"Change",s)})},destructor:function(){var s=this;var x=s.get("source");var v=x.all(".structure-field");v.each(function(B,A,C){var z=s.getFieldInstance(B);if(z){z.destroy()}});var u=s.get("fieldType");if(u=="text_area"){var t=x.one("textarea");if(t){var y=t.attr("name");var w=window[y];if(w&&f.isFunction(w.destroy)){w.destroy()}}}},canDrop:function(){var s=this;return a.prototype.canDrop.apply(s,arguments)},clone:function(){var s=this;var t={};var u=s.portletNamespace;l.each(s.cloneableAttrs,function(w,v,x){t[w]=s.get(w)});t.source=null;return new e(t,u)},createInstructionsContainer:function(s){return l.Node.create(d).html(s)},createTooltipImage:function(){return l.Node.create(b)},getAttribute:function(u,t){var s=this;var w;var v=s.get("source");if(v){w=v.attr("data"+u)}if(f.isUndefined(w)&&!f.isUndefined(t)){w=t}return w},getByName:function(){var s=this;return a.prototype.getByName.apply(s,arguments)},getComponentType:function(){var s=this;return a.prototype.getComponentType.apply(s,arguments)},getContent:function(t){var E=this;var A;var B=E.get("fieldType");var v=t.one("div.journal-article-component-container");var y=v.one(".aui-field-input");if(B=="boolean"){A=y.attr("checked")}else{if(B=="text_area"){var x=t.one("textarea").attr("name");var C=window[x];if(C&&f.isFunction(C.getHTML)){A=C.getHTML()}}else{if(B=="multi-list"){var u=[];var F=y.all("option");F.each(function(H,G,J){if(H.get("selected")){var I=H.val();u.push(I)}});A=u.join(",")}else{if(B=="image"){var z=E.getByName(v,"journalImageDelete");if(z&&(z.val()=="delete")){A="delete"}else{var w=v.one(".journal-image-field input");var s=w.val()||false;if(s){A=s}else{var D=E.getByName(v,"journalImageContent");if(D){A=D.val()}}}}else{if(y){A=y.val()}}}}}if((B=="list")||(B=="multi-list")||(B=="text")||(B=="text_box")){A=Liferay.Util.escapeCDATA(A)}E.set("content",A);return A},getFieldContainer:function(){var G=this;if(!G.fieldContainer){var A=[];var t='\u03a4\u03bf\u03bc\u03ad\u03b1\u03c2';var z='\u004c\u006f\u0063\u0061\u006c\u0069\u007a\u0061\u0062\u006c\u0065';var u='\u0391\u03c5\u03c4\u03cc\u03c2\u0020\u03c4\u03bf\u0020\u03c0\u03b5\u03b4\u03af\u03bf\u0020\u03b5\u03af\u03bd\u03b1\u03b9\u0020\u03c5\u03c0\u03bf\u03c7\u03c1\u03b5\u03c9\u03c4\u03b9\u03ba\u03cc\u002e';var I='\u039c\u03b5\u03c4\u03b1\u03b2\u03bb\u03b7\u03c4\u03cc\u0020\u03cc\u03bd\u03bf\u03bc\u03b1';var B=G.get("optionsEditable");var C=G.getById("editButtonTemplate");var E="";if(C){E=C.html()}var F="";if(!B){F="aui-helper-hidden"}var H=G.getById("repeatableButtonTemplate");var y="";if(H){y=H.html()}var w=G.get("fieldType");var x=G.get("required");var D=G.get("variableName")+k();var v=g();A=f.sub(q,{articleButtonsRowCSSClass:F,editButtonTemplateHTML:E,fieldLabel:t,localizedLabelLanguage:z,instanceId:v,portletNamespace:G.portletNamespace,repeatableButtonTemplateHTML:y,requiredFieldLanguage:u,variableName:D,variableNameLanguage:I});G.fieldContainer=l.Node.create(A);var s=G.fieldContainer.one("li");s.setAttribute("dataName",D);s.setAttribute("dataRequired",x);s.setAttribute("dataType",w);s.setAttribute("dataInstanceId",v);if(!G.canDrop(s)){G.fieldContainer.one(".folder-droppable").remove()}}return G.fieldContainer},getFieldElementContainer:function(){var s=this;if(!s.fieldElementContainer){s.fieldElementContainer=s.getFieldContainer().one("div.journal-article-component-container")}return s.fieldElementContainer},getFieldInstance:function(){var s=this;return a.prototype.getFieldInstance.apply(s,arguments)},getFieldLabelElement:function(){var s=this;var t=s.get("source");if(!t){t=s.getFieldContainer().one("li")}return t.one("> .folder > .field-container .journal-article-field-label")},getLocalizedValue:function(){var s=this;var u=s.get("source");var t;if(u){t=u.one(".journal-article-localized")}return t?t.val():"false"},getRepeatedSiblings:function(){var s=this;return a.prototype.getRepeatedSiblings.apply(s,[s])},propagateAttr:function(t){var s=this;var u=s.getRepeatedSiblings();if(u){u.each(function(x,w,y){var v=s.getFieldInstance(x);if(v){v.set(t.attrName,t.newVal)}})}},setFieldLabel:function(u){var s=this;var t=s.getFieldLabelElement();if(!u){u=s.get("variableName")}t.one("span").html(u);s.setAttribute("fieldLabel",u);return u},setInstanceId:function(x){var s=this;s.setAttribute("instanceId",x);var u=s.get("fieldType");var w=s.get("source");if((u=="image")&&w){var v=s.get("localized");var y=s.portletNamespace+"structure_image_"+x+"_"+s.get("variableName");var t=w.one(".journal-article-component-container [type=file]");if(v){y+="_"+s.get("localizedValue")}t.attr("name",y)}return x},setInstructions:function(A){var B=this;var s=B.get("source");if(s){var C=B.getFieldInstance(s);B.setAttribute("instructions",A);if(C){var u=s.one("> .folder > .field-container");var y=C.getFieldLabelElement();var t=y.one(".journal-article-instructions-container");var v=u.one(".journal-article-instructions-message");var z=C.get("displayAsTooltip");if(t){t.remove()}if(v){v.remove()}if(A){if(!z){var w=C.createInstructionsContainer(A);var x=u.one(".journal-article-required-message");x.placeAfter(w)}else{y.append(C.createTooltipImage())}}}}return A},setRepeatable:function(x){var s=this;var w=s.get("source");s.setAttribute("repeatable",x);if(w){var u=s.getFieldInstance(w);var z=w.one("> .folder > .field-container");var v=z.one(".repeatable-field-image");var t=w.one(".journal-article-buttons .repeatable-button");if(v){v.remove()}if(x){var y=l.Node.create(l.one("#repeatable-field-image-model").html());z.append(y);if(t){t.show()}}else{if(t){t.hide()}}}return x},setVariableName:function(v){var s=this;var u=s.getFieldLabelElement();var t=u.get("parentNode").one(".journal-article-component-container .aui-field-input");if(t){t.attr("id",v);u.setAttribute("for",v)}s.setAttribute("name",v);return v},setAttribute:function(t,v){var s=this;var u=s.get("source");if(f.isArray(v)){v=v[0]}if(u){u.setAttribute("data"+t,v)}return v},_uiSetOptionsEditable:function(v){var s=this;var u=s.get("source");if(u){var t=u.one(".journal-article-buttons");if(t){if(v){t.show()}else{t.hide()}}}},_getNamespacedId:a.prototype._getNamespacedId,getById:a.prototype.getById}});a.StructureField=e;a.FieldModel={};var p=a.FieldModel;var c=function(w,v,x,u){var t=this;var s=l.one('#journalFieldModelContainer div[dataType="'+v+'"]');var y;if(s){y=s.html()}p[w]={fieldLabel:x,fieldType:v,innerHTML:y,optionsEditable:u,variableName:x}};c("Text","text","TextField",true);c("TextArea","text_area","TextAreaField",true);c("TextBox","text_box","TextBoxField",true);c("Image","image","ImageField",true);c("DocumentLibrary","document_library","DocumentLibraryField",true);c("Boolean","boolean","BooleanField",true);c("List","list","ListField",true);c("MultiList","multi-list","MultiListField",true);c("LinkToPage","link_to_layout","LinkToPageField",true);c("SelectionBreak","selection_break","SelectionBreakField",false);Liferay.Portlet.Journal=a},"",{requires:["aui-base","aui-data-set","aui-datatype","aui-dialog","aui-dialog-iframe","aui-io-request","aui-nested-list","aui-overlay-context-panel","json"]});