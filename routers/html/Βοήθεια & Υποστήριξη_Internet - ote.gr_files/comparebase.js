(function(e){e.ns("OTE.Corporate.PS");var b="comparebaseportlet",d=['<li data-id="{id}">','<a href="#" class="close">close</a>','<div class="image-holder"><img src="{image}" width="35" height="60" /></div>','<div class="text">','<a href="{url}"><strong class="title">{title}</strong></a>',"{specialPrice}",'<strong class="price">{price}</strong>',"</div>","</li>"].join(""),a='<strong class="old-price">{priceText} <span class="old">{price}</span></strong>',c=function(j,k,g,i){j+="";var l=j.indexOf(k),m="";if(l!=-1){m=g+j.substring(l+1,j.length);j=j.substring(0,l)}var h=/(\d+)(\d{3})/;while(h.test(j)){j=j.replace(h,"$1"+i+"$2")}return"â‚¬"+j+m},f=function(g){return e("<div/>").text(g||"").html()};OTE.Corporate.PS.Compare=function(){var k,m,p,j,g,o,q,l,n=[],i=[],h=false;return{init:function(t,u,w,x,r,s,v,z){var y=this;k=t;m=u;p=w;j=x;g=r;o=s;q=v;l=z;y.showList();e("#header .navigation .drop-area a.button").click(function(A){y.showCompare();A.preventDefault();return false})},showCompare:function(s){var u=this.getList(),r=[],v,t;if(u.length>0){e.each(u,function(w,x){v={id:x.id,category:x.category};if(x.plan){v.plan=x.plan}if(x.duration){v.duration=x.duration}if(!e.isEmpty(x.specialPrice)){v.specialPrice=x.specialPrice}if(x.buyParams){v.buyParams=x.buyParams}r.push(v);t=x.category})}window.location=m.replace("_replace_me_product_id_",encodeURIComponent(JSON.stringify(r))).replace("_replace_me_category_id_",t||s)},hideList:function(){h=true;e("#header .navigation .drop-area").toggleClass("hidden",true)},getList:function(){var r=r=e.session("ps_compare");return e.isEmpty(r)?[]:JSON.parse(r)},saveList:function(r){e.session("ps_compare",JSON.stringify(r))},addToList:function(A,y){var v=this.getList(),u=true;e.each(v,function(C,D){if(D.id==A.id){u=false;return false}});if(u){if(e.isEmpty(A.productType)){if((v.length>0)&&(v[0].category!=A.category)){if(!y){e("."+b+" a.open-popup").click()}return false}}else{if((v.length>0)&&(v[0].productType!=A.productType)){if(!y){e("."+b+" a.open-popup").click()}return false}}var x=A.price;if((!e.isEmpty(x))&&(typeof x==="number")&&(isFinite(x))){A.price=c(x.toFixed(2),".",j,g)}var r=(A.url||"").split("?");if(r.length>1){var t=r[1].split("&"),z,w,s,B;e.each(t,function(C,D){z=D.split("=");if(z.length==2){w=decodeURIComponent(z[0]);s=decodeURIComponent(z[1]);if((!e.isEmpty(w))&&(!e.isEmpty(s))){if(w==o+"plan"){A.plan=s}if(w==o+"duration"){A.duration=s}if(w==o+"price"){A.specialPrice=parseFloat(s)}if(w==o+"buyParams"){A.buyParams=s}}}})}v.push(A);e.each(n,function(C,D){D(A.id)});while(v.length>k){e.each(i,function(C,D){D(v[0].id)});v.splice(0,1)}this.saveList(v);this.showList()}return true},removeFromList:function(s){var u=this.getList(),r=[],v=e("#header .navigation .drop-area"),t=false;e.each(u,function(w,x){if(x.id==s){e.each(i,function(y,z){z(x.id)});t=true}else{r.push(x)}});if(t){this.saveList(r);if(v.length==0){return}if(r.length==0){v.toggleClass("hidden",true)}else{v.find('ul.compare-product li[data-id="'+s+'"]').remove();v.find(".button-drop strong").text(p+": ("+r.length+")")}}},showList:function(){var r=this,u=e("#header .navigation .drop-area"),t=r.getList(),v=u.find(".button-drop strong"),s=u.find("ul.compare-product");if(u.length==0){return}u.toggleClass("hidden",(t.length==0)||h);v.text(p+": ("+t.length+")");s.empty();e.each(t,function(x,z){var w=z.specialPrice;if((!e.isEmpty(w))&&(typeof w==="number")&&(isFinite(w))){w=(Math.abs(w)<0.01)?l:c(w.toFixed(2),".",j,g)}else{w=null}var B=w||z.price,A=w?a.replace("{priceText}",q).replace("{price}",z.price):"",y=d.replace("{id}",z.id).replace("{image}",z.image).replace("{url}",z.url).replace("{title}",f(z.title)).replace("{price}",f(B)).replace("{specialPrice}",A);s.append(y)});s.find(".image-holder img").imageScale({parent:".image-holder",crop:false});s.find("a.close").click(function(w){r.removeFromList((e(this).parent().attr("data-id")));w.preventDefault();return false})},onAdd:function(s,r){n.push(s)},onRemove:function(r){i.push(r)}}}()})(jQuery);