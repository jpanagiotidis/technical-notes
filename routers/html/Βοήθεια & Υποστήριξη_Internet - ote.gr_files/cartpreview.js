(function(e){e.ns("OTE.Corporate.PS");var i="cartpreviewportlet",j=["<li>",'<div class="block-dark-medium">','<div class="block-dark-holder">','<div class="block-dark-frame">','<div class="shopping-title">','<a href="#" class="btn-close" data-sku="{sku}">close</a>',"<h2>{title}</h2>","</div>","{childrenTemplate}",'<div class="total-row">','<ul class="price-list">',"{monthlyPriceTemplate}","{onceOffPriceTemplate}","</ul>",'<div class="text-in">',"<strong>x {quantity}</strong>","</div>","</div>","</div>","</div>","</div>","</li>"].join(""),k='<div class="row-text">{children}</div>',c='<li><span class="mark">{prompt}</span> <strong>{price}</strong></li>',l='<li><span class="mark">{prompt}</span> <strong>{price}</strong></li>',h='<li><span class="mark">{prompt}</span> <strong>{price}</strong></li>',d='<li><span class="mark">{prompt}</span> <strong>{price}</strong></li>',g=function(p,q,m,o){p+="";var r=p.indexOf(q),s="";if(r!=-1){s=m+p.substring(r+1,p.length);p=p.substring(0,r)}var n=/(\d+)(\d{3})/;while(n.test(p)){p=p.replace(n,"$1"+o+"$2")}return"â‚¬"+p+s},b=function(p,o,n){if(e.isEmpty(p)){return""}var m;if(typeof p==="string"){if(p.indexOf(",")>-1){return p}else{m=Number(p)}}else{if(typeof p==="number"){m=p}else{return p}}if(isFinite(m)){return g(m.toFixed(2),".",o,n)}return p},a=function(m){return decodeURIComponent(m.replace(/\+/g,"%20"))},f=function(m){return e("<div/>").text(m||"").html()};OTE.Corporate.PS.CartPreview=function(){var m,n,q,t,s,o=false,r,p;return{init:function(y,A,z,x,w,B,v){var C=this;m=y;n=A;q=x;t=z;s=w;r=B;p=v;if(e.isEmpty(z)){q=null;C.showCart()}else{e.ajax({url:z,cache:false}).always(function(){C.showCart()})}var u=e("#header .shoping-card .space-area.indent.a-right");u.find("a.link").text(w.viewCart).attr("href",y);u.find("a.button.btn-yellow span").text(w.checkOut);u.find("a.button.btn-yellow").attr("href",A);e("#header .shoping-card .holder > a span").attr("href",y)},hideCart:function(){o=true;e("#header .shoping-card").toggleClass("hidden",true)},getCart:function(){var u=e.cookie("cartCookie");if((e.isEmpty(u))||(u=='""')){return{}}return JSON.parse(JSON.parse(u))},showCart:function(){var v=this,A=e("#header .shoping-card"),z=A.find(".holder > a span"),y=A.find("ul.shopping-list"),w=A.find(".drop-holder > .total-row ul.price-list"),x=v.getCart(),u=x.records||[];if(y.length==0){return}A.toggleClass("hidden",(u.length==0)||o);z.text((u.length==1)?s.titleOneProduct:s.titleManyProducts.replace("{0}",u.length));y.empty();e.each(u,function(C,F){var E=(e.isEmpty(F.mp)||(F.mp===0))?"":c.replace("{prompt}",f(s.monthly)).replace("{price}",f(b(F.mp,r,p))),B=(e.isEmpty(F.oop)||(F.oop===0))?"":l.replace("{prompt}",f(s.onceOff)).replace("{price}",f(b(F.oop,r,p))),G="";if(!e.isEmpty(F.child)){e.each(F.child.split("#"),function(H,I){G+="<p>"+f(a(I))+"</p>"})}var D=j.replace("{title}",f(a(F.title))).replace("{sku}",F.sku).replace("{childrenTemplate}",G).replace("{monthlyPriceTemplate}",E).replace("{onceOffPriceTemplate}",B).replace("{quantity}",f(F.qty));y.append(D)});if(!e.isEmpty(q)){y.find("a.btn-close").click(function(){var B=e(this).attr("data-sku");e.ajax({url:q.replace("_replace_me_product_id_",B),cache:false}).always(function(){v.showCart()});return false})}w.empty();if(x.tmp>0){w.append(h.replace("{prompt}",f(s.totalMonthly)).replace("{price}",f(b(x.tmp,r,p))))}if(x.toop>0){w.append(d.replace("{prompt}",f(s.totalOnceOff)).replace("{price}",f(b(x.toop,r,p))))}}}}()})(jQuery);